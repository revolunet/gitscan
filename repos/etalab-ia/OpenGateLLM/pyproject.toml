[project]
name = "opengatellm"
version = "0.4.0.rc-1"
description = "OpenGateLLM project"
requires-python = ">=3.12"
license = { text = "MIT" }
dependencies = [
    "requests==2.32.4",
    "pydantic==2.12.5",
    "pydantic-settings==2.12.0",
    "httpx>=0.27.0",
    "pyyaml==6.0.2",
    "pycountry==24.6.1",
]

[project.optional-dependencies]
playground = [
    "reflex==0.8.17",
]
api = [
    # auth
    "authlib>=1.6.0",
    "python-jose==3.4.0",
    "limits==5.6.0",
    "tiktoken==0.9.0",
    "ecologits==0.8.2",
    "itsdangerous>=2.2.0",
    "cryptography>=3.4.8",
    "openai>=2.15.0",
    "mistralai==1.10.0",

    # data
    "langchain-text-splitters>=1.1.0",
    "elasticsearch[async]==9.0.1",
    "redis==5.2.1",
    "beautifulsoup4==4.13.4",
    "PyMuPDF==1.26.7",
    "pymupdf4llm>=0.2.9",
    "alembic>=1.15.2",
    "psycopg2-binary==2.9.10",
    "asyncpg==0.30.0",
    "sqlalchemy[asyncio]==2.0.43",
    "sqlalchemy-utils==0.41.2",
    "sentry-sdk[fastapi]>=2.28.0",
    "bcrypt==4.3.0",

    
    # app
    "gunicorn==23.0.0",
    "fastapi>=0.128.0",
    "prometheus-fastapi-instrumentator==7.0.2",
    "uvicorn==0.37.0",
    "python-multipart==0.0.20",
    "html-to-markdown==1.4.0",
    "celery==5.5.3"

]
worker = [
    "redis==5.2.1",
    "pycountry==24.6.1",
    "celery==5.5.3"
]
dev = [
    "nbconvert==7.16.6",
    "uvicorn==0.37.0",
    "ruff==0.6.5",
    "pre-commit==4.1.0",
    "jupyter==1.1.1",
]
test = [
    "pytest==8.3.4",
    "pytest-cov==6.0.0",
    "pytest-snapshot==0.9.0",
    "pytest-xdist==3.6.1",
    "pytest-asyncio==1.0.0",
    "pytest-mock==3.14.1",
    "respx==0.22.0",
    "responses==0.25.8",
    "openmockllm @ git+https://github.com/etalab-ia/openmockllm.git@main",
    "factory-boy==3.3.3",
    "gevent==25.9.1"

]

[tool.setuptools]
py-modules = []

[tool.ruff]
line-length = 150
exclude = [
    "**/alembic",
]

[tool.ruff.lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort
    "N",   # pep8-naming
    "UP",  # pyupgrade
]
ignore = [
    "F403",  # import * 
    "F841",  # never used variables
    "E501",  # line too long
    "N806",  # force lowercase
    "UP031", # format specifiers instead of percent format
    "W291",  # trailing whitespace
    "N805",  # first argument of a class method call is self
    "N815",  # mixed case variable name
]

[tool.ruff.lint.isort]
force-sort-within-sections = true
known-first-party = ["config", "utils", "api", "app"]
forced-separate = ["tests"]

[tool.ruff.lint.isort.sections]
sections = ["FUTURE", "STDLIB", "THIRDPARTY", "FIRSTPARTY", "LOCALFOLDER"]

[tool.pytest.ini_options]
pythonpath = ["."]
testpaths = ["tests"]
log_cli = true
log_cli_level = "INFO"
log_cli_format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
log_cli_date_format = "%Y-%m-%d %H:%M:%S"
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "session"
filterwarnings = [
    # Ignore warnings from external libraries
    "ignore:builtin type Swig.*:DeprecationWarning",
    # factory_boy doesn't fully support async SQLAlchemy sessions
    "ignore:coroutine 'AsyncSession.flush' was never awaited:RuntimeWarning",
]