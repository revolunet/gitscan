name: GitScan

on:
    workflow_dispatch:
    schedule:
        - cron: "0 0 * * 0" # see https://crontab.guru

# allow only one concurrent scan action
concurrency:
    cancel-in-progress: true
    group: scans

jobs:
    init:
        runs-on: ubuntu-latest
        name: Prepare
        outputs:
            sites: ${{ steps.init.outputs.sites }}
        steps:
            - uses: actions/checkout@v4
            - id: init
              uses: "./.github/actions/init.yml@v1"
              with:
                  count: 10
    scans:
        runs-on: ubuntu-latest
        name: Scan
        needs: init
        continue-on-error: true
        strategy:
            fail-fast: false
            max-parallel: 3
            matrix:
                sites: ${{ fromJson(needs.init.outputs.sites) }}
        steps:
            - uses: actions/checkout@v4
              with:
                  ref: ${{ github.ref }}

            - run: |
                  ls

            # - name: "Commit retry 2"
            #   if: steps.commit2.outcome=='failure'
            #   run: |
            #       git config --global user.email 41898282+github-actions[bot]@users.noreply.github.com
            #       git config --global user.name GitHub
            #       git add "results"
            #       git commit -m "update: ${{ matrix.sites.url }}"
            #       git pull --rebase --no-ff origin ${{ github.ref }}
            #       git push
